<%
   # eliminar este comentario
   f = locals[:f]
   field = locals[:field]
   association = field.to_s.split('_files')[0].to_sym
   label = locals[:label] || t("simple_form.labels.defaults.#{association}")
%>

<%= f.input field, as: :attachment, multiple: true, direct: locals[:direct] || true, label: false, input_html: {style: 'display: none;'} %>
<div class="form-group">
  <label class="col-xs-12 col-sm-3 control-label" for="">Files</label>
  <div class="col-sm-8">
    <div class="upload-dropzone dropzone dz-clickable" data-upload-field="images" id="mydropzone">
      <div class="dz-default dz-message">
        <div class="col-xs-12">
          <h3><i class="fa fa-caret-right text-danger"></i> Drop files to upload.
            <span class="small"> (Or Click)</span>
          </h3>
        </div>

      </div>
    </div>
  </div>
</div>
<%= locals[:f].fields_for locals[:relation_attaches] do |upload| %>
  <div class="hidden">
    <%= upload.input :_destroy, as: :boolean, wrapper: :clean, label: false, input_html: {style: 'display: none;'} %>
  </div>
<% end %>
<script type="text/javascript">
    Dropzone.options.mydropzone = {
        maxFiles: null,
        init: function(file, done) {
            thisDropzone = this;
            var mockFile = {};
            var indexVar = 0;
            <%= locals[:f].fields_for locals[:relation_attaches], nil, {wrapper: false, include_id: false} do |uploaded| %>
            <% f_input_string = uploaded.input :_destroy, as: :boolean, wrapper: :clean
            hidden_name = f_input_string.split('name="')[1].split('"')[0] %>
            mockFile = {
              name: '<%= uploaded.object.file_filename %>',
              size: <%= uploaded.object.file_size %>,
              type: '<%= uploaded.object.file_content_type %>',
              hidden_name: '<%= hidden_name %>',
              index: indexVar
            };
            thisDropzone.options.addedfile.call(thisDropzone, mockFile);
            thisDropzone.options.thumbnail.call(thisDropzone, mockFile, '<%= attachment_url(uploaded.object, :file, :fill, 100, 100) %>');
            noImage(mockFile);
            indexVar++;
            <% end %>
            $('#mydropzone').removeClass('dz-started');
            $('.dz-image').children().before('<i class="fileUploadedCheck fa fa-2x fa-check-circle"></i>');
            $('.dz-progress').fadeOut();
        },
        accept: function(file, done) {
          console.log(file, done);
            back_files_news(file, done);
        }
    };
</script>
